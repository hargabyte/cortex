<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX Health Report - Cortex</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-yellow: #d29922;
            --accent-red: #f85149;
            --accent-purple: #a371f7;
            --border-color: #30363d;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        h1 { font-size: 2.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        .subtitle { color: var(--text-secondary); font-size: 1.1rem; }
        .timestamp { color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem; }

        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--accent-blue);
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .risk-score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .risk-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 700;
            background: conic-gradient(var(--accent-yellow) 0deg 180deg, var(--bg-tertiary) 180deg 360deg);
        }

        .risk-circle-inner {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .risk-details { text-align: left; }
        .risk-label { font-size: 1.2rem; color: var(--text-secondary); }
        .risk-value { font-size: 2rem; font-weight: 600; color: var(--accent-yellow); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .stat-value.critical { color: var(--accent-red); }
        .stat-value.warning { color: var(--accent-yellow); }
        .stat-value.success { color: var(--accent-green); }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .issue-list { list-style: none; }

        .issue-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .issue-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .issue-icon.critical { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        .issue-icon.warning { background: rgba(210, 153, 34, 0.2); color: var(--accent-yellow); }
        .issue-icon.info { background: rgba(88, 166, 255, 0.2); color: var(--accent-blue); }

        .issue-content { flex: 1; }
        .issue-title { font-weight: 600; margin-bottom: 0.25rem; }
        .issue-meta { font-size: 0.875rem; color: var(--text-secondary); }
        .issue-recommendation { font-size: 0.875rem; color: var(--accent-purple); margin-top: 0.5rem; }

        .file-path {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.8rem;
            color: var(--accent-blue);
            background: var(--bg-tertiary);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-critical { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        .badge-warning { background: rgba(210, 153, 34, 0.2); color: var(--accent-yellow); }
        .badge-info { background: rgba(88, 166, 255, 0.2); color: var(--accent-blue); }
        .badge-success { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }

        .module-group {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            cursor: pointer;
        }

        .module-header:hover { background: #2d333b; }

        .module-name {
            font-weight: 600;
            font-family: 'SFMono-Regular', Consolas, monospace;
            color: var(--accent-blue);
        }

        .module-count {
            background: var(--accent-yellow);
            color: var(--bg-primary);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .module-candidates {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .module-group.expanded .module-candidates {
            max-height: 2000px;
            padding: 0.5rem 0;
        }

        .candidate-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.6rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }

        .candidate-item:last-child { border-bottom: none; }

        .candidate-type {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            background: var(--bg-tertiary);
            color: var(--accent-purple);
            font-family: monospace;
            min-width: 60px;
            text-align: center;
        }

        .candidate-name {
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-weight: 500;
            flex: 1;
        }

        .candidate-location {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
        }

        .comparison-table .before { color: var(--accent-red); }
        .comparison-table .after { color: var(--accent-green); }
        .comparison-table .change { color: var(--accent-blue); font-weight: 600; }

        .highlight-box {
            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .highlight-box h3 {
            color: var(--accent-green);
            margin-top: 0;
        }

        .expand-icon {
            transition: transform 0.3s ease;
        }

        .module-group.expanded .expand-icon {
            transform: rotate(90deg);
        }

        .section-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CX Health Report</h1>
            <p class="subtitle">Cortex Codebase Analysis</p>
            <p class="timestamp">Generated: January 20, 2026 at 21:14 UTC</p>
        </header>

        <!-- Risk Score -->
        <div class="risk-score">
            <div class="risk-circle">
                <div class="risk-circle-inner">50</div>
            </div>
            <div class="risk-details">
                <div class="risk-label">Overall Risk Score</div>
                <div class="risk-value">Medium Risk</div>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    Primary concerns: untested keystones and potential dead code
                </p>
            </div>
        </div>

        <!-- Improvement Highlight -->
        <div class="highlight-box">
            <h3>Dead Code Detection Improved</h3>
            <p>This report uses the new whitelist-based dead code detection that filters out false positives from imports, variables, and constants.</p>
            <table class="comparison-table" style="margin-top: 1rem;">
                <tr>
                    <th>Metric</th>
                    <th>Before</th>
                    <th>After</th>
                    <th>Improvement</th>
                </tr>
                <tr>
                    <td>Dead Code Candidates</td>
                    <td class="before">641</td>
                    <td class="after">50</td>
                    <td class="change">-92%</td>
                </tr>
                <tr>
                    <td>False Positive Rate</td>
                    <td class="before">~90%</td>
                    <td class="after">0%</td>
                    <td class="change">Eliminated</td>
                </tr>
                <tr>
                    <td>Output Format</td>
                    <td class="before">Flat list</td>
                    <td class="after">Grouped by module</td>
                    <td class="change">Actionable</td>
                </tr>
            </table>
        </div>

        <!-- Summary Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value critical">46</div>
                <div class="stat-label">Critical Issues</div>
            </div>
            <div class="stat-card">
                <div class="stat-value warning">0</div>
                <div class="stat-label">Warnings</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">50</div>
                <div class="stat-label">Dead Code Candidates</div>
            </div>
            <div class="stat-card">
                <div class="stat-value success">4</div>
                <div class="stat-label">Modules with Dead Code</div>
            </div>
        </div>

        <!-- Critical Issues -->
        <h2>Critical Issues <span class="badge badge-critical">46</span></h2>
        <p class="section-description">Untested keystone entities that should be prioritized for test coverage.</p>

        <ul class="issue-list">
            <li class="issue-item">
                <div class="issue-icon critical">!</div>
                <div class="issue-content">
                    <div class="issue-title">walkNode</div>
                    <div class="issue-meta">
                        <span class="file-path">internal/parser/parser.go</span>
                        <span class="badge badge-critical">keystone</span>
                        PageRank: 0.034
                    </div>
                    <div class="issue-recommendation">Add tests for walkNode - this is a keystone entity with high importance</div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon critical">!</div>
                <div class="issue-content">
                    <div class="issue-title">Store</div>
                    <div class="issue-meta">
                        <span class="file-path">internal/store/db.go</span>
                        <span class="badge badge-critical">keystone</span>
                        PageRank: 0.023
                    </div>
                    <div class="issue-recommendation">Add tests for Store - this is a keystone entity with high importance</div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon critical">!</div>
                <div class="issue-content">
                    <div class="issue-title">nodeText</div>
                    <div class="issue-meta">
                        <span class="file-path">internal/extract/typescript.go</span>
                        <span class="badge badge-critical">keystone</span>
                        PageRank: 0.023
                    </div>
                    <div class="issue-recommendation">Add tests for nodeText - this is a keystone entity with high importance</div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon critical">!</div>
                <div class="issue-content">
                    <div class="issue-title">Close</div>
                    <div class="issue-meta">
                        <span class="file-path">internal/store/db.go</span>
                        <span class="badge badge-critical">keystone</span>
                        PageRank: 0.022
                    </div>
                    <div class="issue-recommendation">Add tests for Close - this is a keystone entity with high importance</div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon critical">!</div>
                <div class="issue-content">
                    <div class="issue-title">Entity</div>
                    <div class="issue-meta">
                        <span class="file-path">internal/store/types.go</span>
                        <span class="badge badge-critical">keystone</span>
                        PageRank: 0.016
                    </div>
                    <div class="issue-recommendation">Add tests for Entity - this is a keystone entity with high importance</div>
                </div>
            </li>
        </ul>
        <p style="color: var(--text-secondary); margin-top: 0.5rem; font-style: italic;">
            + 41 more untested keystones...
        </p>

        <!-- Dead Code Groups (NEW FORMAT) -->
        <h2>Dead Code Candidates <span class="badge badge-info">50</span></h2>
        <p class="section-description">
            Potential dead code grouped by module. These are functions, methods, and types with no incoming dependencies.
            Only trackable entity types are shown (imports, variables, and constants are excluded).
        </p>

        <div class="module-group expanded">
            <div class="module-header" onclick="this.parentElement.classList.toggle('expanded')">
                <span class="module-name">internal/cmd</span>
                <span>
                    <span class="module-count">37</span>
                    <span class="expand-icon" style="margin-left: 0.5rem;">▶</span>
                </span>
            </div>
            <div class="module-candidates">
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runContext</span>
                    <span class="candidate-location">context.go:190</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runImport</span>
                    <span class="candidate-location">coverage.go:110</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runStatus</span>
                    <span class="candidate-location">coverage.go:306</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runDaemonControlStatus</span>
                    <span class="candidate-location">daemon.go:182</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runDaemonControlStop</span>
                    <span class="candidate-location">daemon.go:289</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runDaemonControlStart</span>
                    <span class="candidate-location">daemon.go:308</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runDaemonMCP</span>
                    <span class="candidate-location">daemon.go:369</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">useDaemon</span>
                    <span class="candidate-location">daemon_client.go:42</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">resetDaemonClient</span>
                    <span class="candidate-location">daemon_client.go:49</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">runDbInfo</span>
                    <span class="candidate-location">db.go</span>
                </div>
                <p style="padding: 0.5rem 1.25rem; color: var(--text-secondary); font-style: italic;">
                    + 27 more functions in this module...
                </p>
            </div>
        </div>

        <div class="module-group">
            <div class="module-header" onclick="this.parentElement.classList.toggle('expanded')">
                <span class="module-name">internal/cache</span>
                <span>
                    <span class="module-count">3</span>
                    <span class="expand-icon" style="margin-left: 0.5rem;">▶</span>
                </span>
            </div>
            <div class="module-candidates">
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">scanMetrics</span>
                    <span class="candidate-location">metrics.go</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">scanMetricsRows</span>
                    <span class="candidate-location">metrics.go</span>
                </div>
                <div class="candidate-item">
                    <span class="candidate-type">function</span>
                    <span class="candidate-name">initSchema</span>
                    <span class="candidate-location">schema.go</span>
                </div>
            </div>
        </div>

        <div class="module-group">
            <div class="module-header" onclick="this.parentElement.classList.toggle('expanded')">
                <span class="module-name">internal/bd</span>
                <span>
                    <span class="module-count">1</span>
                    <span class="expand-icon" style="margin-left: 0.5rem;">▶</span>
                </span>
            </div>
            <div class="module-candidates">
                <div class="candidate-item">
                    <span class="candidate-type">type</span>
                    <span class="candidate-name">jsonlDependency</span>
                    <span class="candidate-location">deps.go</span>
                </div>
            </div>
        </div>

        <!-- Complexity Hotspots -->
        <h2>Complexity Hotspots</h2>
        <p class="section-description">Functions with high out-degree (many dependencies) that may benefit from refactoring.</p>

        <ul class="issue-list">
            <li class="issue-item">
                <div class="issue-icon warning">⚡</div>
                <div class="issue-content">
                    <div class="issue-title">runContext</div>
                    <div class="issue-meta">
                        Out-degree: 56 | Lines: 291
                    </div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon warning">⚡</div>
                <div class="issue-content">
                    <div class="issue-title">runFindWithRanking</div>
                    <div class="issue-meta">
                        Out-degree: 45 | Lines: 231
                    </div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon warning">⚡</div>
                <div class="issue-content">
                    <div class="issue-title">runShowDefault</div>
                    <div class="issue-meta">
                        Out-degree: 44 | Lines: 113
                    </div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon warning">⚡</div>
                <div class="issue-content">
                    <div class="issue-title">runSafeDrift</div>
                    <div class="issue-meta">
                        Out-degree: 40 | Lines: 336
                    </div>
                </div>
            </li>
            <li class="issue-item">
                <div class="issue-icon warning">⚡</div>
                <div class="issue-content">
                    <div class="issue-title">extractEntitiesFromContent</div>
                    <div class="issue-meta">
                        Out-degree: 38 | Lines: 73
                    </div>
                </div>
            </li>
        </ul>
        <p style="color: var(--text-secondary); margin-top: 0.5rem; font-style: italic;">
            + 15 more complexity hotspots...
        </p>

        <!-- Footer -->
        <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-secondary);">
            <p>Generated by CX (Cortex) - Codebase Analysis Tool</p>
            <p style="font-size: 0.875rem; margin-top: 0.5rem;">
                Entity whitelist: function, method, class, interface, struct, type, trait, enum
            </p>
        </footer>
    </div>

    <script>
        // Toggle all module groups
        document.querySelectorAll('.module-header').forEach(header => {
            header.addEventListener('click', function() {
                this.parentElement.classList.toggle('expanded');
            });
        });
    </script>
</body>
</html>
